<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SAPL Login</title>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: Arial;
        background: #0a0a0a;
        height: 100vh;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .header {
        width: 100%;
        background: #1a1a1a;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-sizing: border-box;
        border-bottom: 2px solid #444;
    }

    .header img {
        width: 55px;
        height: auto;
    }

    .header-title {
        font-size: 22px;
        font-weight: bold;
        color: #fff;
        letter-spacing: 1px;
    }

    .login-box {
        margin-top: 25px;
        background: #1a1a1a;
        padding: 20px;
        border-radius: 10px;
        width: 260px;
        box-shadow: 0 0 10px #000;
    }

    select, input {
        width: 100%;
        padding: 8px;
        font-size: 16px;
        margin-bottom: 10px;
    }

    table {
        margin-top: 20px;
        border-collapse: collapse;
        width: 96%;
        color: white;
    }

    th, td {
        border: 1px solid #555;
        padding: 8px;
        text-align: center;
    }

    th {
        background: #222;
    }

    .readonly {
        background: #555 !important;
        pointer-events: none;
    }

    button {
        padding: 8px 12px;
        background: #222;
        color: white;
        border: none;
        cursor: pointer;
        margin-top: 10px;
    }
</style>
</head>

<body>

<div class="header">
    <img src="logo.png" />
    <div class="header-title">Shaheen Automotive Pvt Ltd</div>
</div>

<div class="login-box" id="loginBox">
    <h3>Login</h3>
    <select id="userSelect">
        <option value="" disabled selected>Select User</option>
        <option value="kamran">Admin (Kamran)</option>
        <option value="store">Store</option>
        <option value="welding">Welding</option>
        <option value="fg">FG</option>
        <option value="production">Production</option>
    </select>

    <input type="password" id="pwdInput" placeholder="Password" />
    <button id="loginBtn">Login</button>
</div>

<div id="loggedAs" style="margin-top:10px;"></div>
<button id="logoutBtn" style="display:none;">Logout</button>

<table id="dataTable" style="display:none;">
    <thead>
        <tr>
            <th>Part Name</th>
            <th>Today Prod</th>
            <th>Today Pending</th>
            <th>Remaining</th>
            <th>Final Done</th>
            <th>NG</th>
            <th>Apply Store</th>
            <th>Apply FG</th>
        </tr>
    </thead>
    <tbody id="tbody"></tbody>
</table>

<script>
let users = [
    { username:"kamran", password:"c", role:"admin", label:"Admin" },
    { username:"store", password:"s", role:"store", label:"Store" },
    { username:"welding", password:"w", role:"welding", label:"Welding" },
    { username:"fg", password:"f", role:"fg", label:"FG" },
    { username:"production", password:"p", role:"production", label:"Production" }
];

let currentUser = null;

let parts = JSON.parse(localStorage.getItem("sapldata") || "[]");

if(parts.length === 0){
    parts = [
        { name:"Part-A", tProd:"", tPend:"", rem:"", fDone:"", ng:"", store:"", fg:"" },
        { name:"Part-B", tProd:"", tPend:"", rem:"", fDone:"", ng:"", store:"", fg:"" }
    ];
}

function saveData(){
    localStorage.setItem("sapldata", JSON.stringify(parts));
}

function renderTable(){
    let tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    parts.forEach((p,i)=>{
        let tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${p.name}</td>

            <td><input data-i="${i}" data-k="tProd" value="${p.tProd}"></td>
            <td><input data-i="${i}" data-k="tPend" value="${p.tPend}"></td>
            <td><input data-i="${i}" data-k="rem" value="${p.rem}"></td>

            <td><input data-i="${i}" data-k="fDone" value="${p.fDone}"></td>
            <td><input data-i="${i}" data-k="ng" value="${p.ng}"></td>

            <td><input data-i="${i}" data-k="store" value="${p.store}"></td>
            <td><input data-i="${i}" data-k="fg" value="${p.fg}"></td>
        `;

        tbody.appendChild(tr);
    });

    applyRoleLock();
}

function applyRoleLock(){
    let allInputs = document.querySelectorAll("tbody input");

    allInputs.forEach(inp=>{
        inp.classList.remove("readonly");
        inp.readOnly = false;
    });

    if(!currentUser) return;

    if(currentUser.role === "production"){
        lock("tProd");
        lock("tPend");
        lock("rem");
        // FinalDone, NG, ApplyStore, ApplyFG remain ACTIVE
    }
}

function lock(col){
    document.querySelectorAll(`input[data-k="${col}"]`).forEach(inp=>{
        inp.classList.add("readonly");
        inp.readOnly = true;
    });
}

document.getElementById("tbody").addEventListener("input", e=>{
    let i = e.target.dataset.i;
    let k = e.target.dataset.k;
    parts[i][k] = e.target.value;
    saveData();
});

document.getElementById("loginBtn").addEventListener("click", ()=>{
    const u = users.find(x => x.username === userSelect.value);

    if(!u) return alert("User not found");
    if(pwdInput.value !== u.password) return alert("Wrong Password");

    currentUser = u;
    loginBox.style.display="none";
    dataTable.style.display="table";
    logoutBtn.style.display="block";
    loggedAs.textContent = "Logged in as: " + u.label;

    renderTable();
});

document.getElementById("logoutBtn").addEventListener("click", ()=>{
    location.reload();
});
</script>

</body>
</html>
